<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TODO App</title>
    <script src="elm.js"></script>
  </head>

  <body>
    <main></main>
    <script defer>
      const { invoke } = window.__TAURI__.core;

      // Initialize Elm application
      const app = Elm.Main.init({
        node: document.querySelector('main')
      });

      // Handle commands from Elm
      app.ports.invoke.subscribe(async ({cmd, params=null}) => {
        try {
          let result;
          switch (cmd) {
            case "get_todos":
              result = await invoke("get_todos");
              app.ports.receiveTodos.send(result);
              break;
            case "add_todo":
              await invoke("add_todo", {params});
              result = await invoke("get_todos");
              app.ports.receiveTodos.send(result);
              break;
            case "update_todo":
              await invoke("update_todo", {params});
              result = await invoke("get_todos");
              app.ports.receiveTodos.send(result);
              break;
            case "delete_todo":
              await invoke("delete_todo", {params});
              result = await invoke("get_todos");
              app.ports.receiveTodos.send(result);
              break;
          }
        } catch (error) {
          console.error("Error:", error);
          app.ports.receiveTodos.send({ error: error.message });
        }
      });
    </script>
  </body>
</html>
